{% extends "bootstrap/base.html" %}

{% block styles %}
{{ super() }}
<style>
/* Custom CSS to align the navbar toggle button to the left */


.navbar-toggle {
    float: left; /* Positions the button on the left */
    margin-left: 15px; /* Adds space between the button and the brand */
}
.navbar-toggle {
    display: block !important; /* Ensures the button is always displayed */
    visibility: visible !important; /* Ensures the button is not hidden */
}

.navbar .container-fluid {
    display: flex;
    align-items: center; /* Vertically centers the flex items */
    justify-content: space-between;
    height: 100%;
    flex-direction: row;
}
/* Ensure the parent container of .navbar-right is a flex container */


.navbar-right {
    display: flex;
    align-items: center; /* Align items vertically in the center, if needed */
    margin-left: auto;
}



#sidebar-collapse {
    height: 100%;
    width: 250px; /* Adjust the width as needed */
    position: fixed;
    z-index: 1;
    top: 0;
    left: 0;
    background-color: #f8f8f8; /* Light grey background */
    overflow-x: hidden;
    padding-top: 20px;
    transition: 0.5s; /* Smooth transition */
}

#sidebar-collapse.collapsing {
    transition: height 0.3s ease;
}

#sidebar-collapse .nav {
    display: block;
}

.navbar-toggle.collapsed + #sidebar-collapse {
    left: -250px; /* Adjust based on the sidebar width */
}




/* CSS: Add this to your stylesheet */
.sidebar {
    height: 100%; /* Full-height: remove this if you want "auto" height */
    width: 150px; /* Set the width of the sidebar */
    position: fixed; /* Fixed Sidebar (stay in place on scroll) */
    z-index: 1; /* Stay on top */
    top: 0; /* Stay at the top */
    left: 0;
    background-color: #f0f8ff; /* white */
    overflow-x: hidden; /* Disable horizontal scroll */
    padding-top: 20px;
  }

.sidebar-links {
    display: flex;
    flex-direction: column;
}
  /* Initial sidebar styles */
#sidebar-collapse {
    position: fixed;
    top: 0;
    left: -150px; /* Start off-screen */
    width: 150px;
    height: 100%;
    background: #f8f8f8;
    transition: left 0.0s;
}
/* Button starts at its initial position */
.navbar-toggle {
    transition: transform 0.1s;
}

/* Adjusted button position when sidebar is open */
.navbar-toggle.adjusted {
    transform: translateX(150px); /* Move button to the right */
}

.sidebar a {
    padding: 10px;
    text-decoration: none;
    font-size: 18px;
    color: #000000;
    display: block;
}
.sidebar a:hover {
    background-color: #ffffff;
}
.sidebar .submenu a {
    padding-left: 30px;
}



</style>

{% endblock %}



{%block title%}Base{%endblock%}


{% block navbar %}


<script>
    window.onload = function() { // Ensures the page is fully loaded
        function adjustNavbarMargin() {
            var sidebar = document.getElementById('sidebar-collapse');
            var navbar = document.querySelector('.navbar');
            if (sidebar && navbar) {
                // More reliable check for sidebar visibility
                var isSidebarVisible = window.getComputedStyle(sidebar).display !== 'none';
                if (isSidebarVisible) {
                    // Sidebar is visible, adjust navbar margin
                    var sidebarWidth = sidebar.offsetWidth;
                    navbar.style.marginLeft = sidebarWidth + 'px';
                } else {
                    // Sidebar is hidden, reset navbar margin
                    navbar.style.marginLeft = '0';
                }
            }
        }

        // Adjust navbar margin on page load
        adjustNavbarMargin();

        // Listen for sidebar toggle
        document.addEventListener('click', function(event) {
            var toggleButton = event.target.closest('[data-toggle="collapse"]');
            if (toggleButton) {
                // Delay adjustment to wait for potential CSS transitions
                setTimeout(adjustNavbarMargin, 350); // Adjust based on your CSS
            }
        });
    };

    document.addEventListener('DOMContentLoaded', function() {
        var toggleButton = document.querySelector('[data-toggle="collapse"]');
        var mainContent = document.getElementById('main_content');
    
        if (toggleButton && mainContent) {
            toggleButton.addEventListener('click', function() {
                // Check if sidebar is shown or hidden based on its class
                var sidebar = document.getElementById('sidebar-collapse');
                if (sidebar.classList.contains('in')) { // Assuming Bootstrap 3.x for 'in' class
                    // Sidebar is now shown, make main_content dark and unselectable
                    mainContent.classList.add('dark-unselectable');
                } else {
                    // Sidebar is now hidden, revert main_content styles
                    // Delay this action if your sidebar has a transition
                    setTimeout(function() {
                        mainContent.classList.remove('dark-unselectable');
                    }, 350); // Adjust timeout to match sidebar transition
                }
            });
        }
    });

    $(document).ready(function() {

        $("#sidebar-collapse").mCustomScrollbar({
            theme: "minimal"
        });
    
        $('#dismiss, .overlay').on('click', function() {
            $('#sidebar').removeClass('active');
            $('.overlay').removeClass('active');
        });
    
        $('#sidebar-collapse').on('click', function() {
            $('#sidebar').addClass('active');
            $('.overlay').addClass('active');
            $('.collapse.in').toggleClass('in');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        });
    
        // Add event listener to collapse sidebar when clicking outside of it
        $(document).on('click', function(event) {
            if (!$(event.target).closest('#sidebar, #sidebar-collapse').length) {
                $('#sidebar').removeClass('active');
                $('.overlay').removeClass('active');
            }
        });
    });
</script>

<nav class="navbar navbar-default">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
        <div class="topbar">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <div class="navbar-right">
            <div class="dropdown">
                <button class="btn btn-default dropdown-toggle" type="button" id="userMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {% if user.is_authenticated %}
                        {{ user.user }} <span class="caret"></span>
                    {% else %}
                        登录<span class="caret"></span>
                    {% endif %}
                </button>

                <ul class="dropdown-menu" aria-labelledby="userMenu">
                    {% if user.is_authenticated %}
                    <li><a href="{{ url_for('logout') }}">退出</a></li>
                     {% else %}
                     <li><a></a></li>
                     {% endif %}

                </ul>
            </div>
        </div>
</nav>

    <div class="collapse" id="sidebar-collapse">
        <div class="sidebar">
            <a href="#">组织架构</a>
            <div class="submenu">
                <a href="#">综合AI</a>
            </div>
            <a href="#">流动红旗</a>
            <div class="submenu">
                <a href="{{url_for('evaluation')}}">开始评价</a>
                <a href="{{url_for('evaluation_settings')}}">评价设置</a>
                <a href="#">默认评价地点</a>
                <a href="#">默认评价班级</a>
                <a href="#">记录管理</a>
                <a href="{{url_for('evaluation_results')}}">评价结果</a>
                <a href="#">评比设置</a>
                <a href="#">地点管理</a>
            </div>
            <a href="#">教师评价</a>
            <a href="#">学校设置</a>
        </div>
    </div>

{% endblock %}

{%block content %}


<script>
    // JavaScript to hide the flash message after 3 seconds
    setTimeout(function() {
        var flashMessage = document.getElementById('flash-message');
        if (flashMessage) {
            flashMessage.style.display = 'none';
        }
    }, 1000); // 3000 milliseconds = 3 seconds
</script>

<div class="container">

    {% with messages = get_flashed_messages() %}
    {% if messages %}
        <div id="flash-message" class="alert alert-warning text-center">
            <p>{{ messages[0] }}</p>
        </div>
    {% endif %}
{% endwith %}


	{%block main_content%}{%endblock%}

</div>



{%endblock%}

